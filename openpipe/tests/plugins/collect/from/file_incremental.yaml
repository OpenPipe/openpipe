start:
    - directory: tmp/

    # Create file with a single line
    - insert: "Line 1\n"
    - export to file:
        path: test.txt
        close_on_item: True

    # Check file content, on first run
    - duplicate: check_file_content
    - insert: "Line 2\n"

    # Append a line
    - export to file:
        path: test.txt
        mode: a # Append
        close_on_item: True
    - duplicate: check_file_content
    - collect from file:
        path: test.txt

    # Check that full content of file is ok
    - assert:
        - Line 1
        - Line 2

    # Print only on last line
    - filter:
        in: $ '2' in _ $
    - print: Full file content is ok

check_file_content:
    - collect from file_incremental:
        path: test.txt
    - assert: Line 2
    - print: "Found second line: $_$"